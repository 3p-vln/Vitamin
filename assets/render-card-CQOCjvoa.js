import{g as P,a as y}from"./useApi-vFXYCa-6.js";import{g as d,r as c,c as $}from"./useCallDom-cDO4lF47.js";let u=1,g=10,_=6;const m=window.innerWidth;let p;async function A(e){const i=d(e);if(!i)return;const t=await P(!1);if(t.errors)return;const n=t.data;await w(n,i,"white")}function x(){const e=window.innerWidth;e<375?(g=4,_=2):e<768?(g=6,_=6):(g=10,_=10)}async function D(e,i=1,t){x();const n=d(e);if(!n)return;let r=await y(i,g,t);if(r.errors||r.data.length===0){n.innerHTML="<p>Нет товаров в данной категории</p>";return}console.log(r);const o=r.data;await w(o,n,"gray"),m>=768&&v(e,t),m<768&&E(e,t)}async function w(e,i,t){e.forEach(n=>{const r=c("a",["prod-card",`${n.id}`,`prod-card_${t}`]),o=c("div","prod-card__content"),s=c("div","prod-card__img");s.innerHTML=`<picture><img src="${n.img}" /></picture>`;const a=c("div","prod-card__discount");a.innerText=`-${n.discount}%`;const l=c("div",["prod-card__info","info"]),h=c("p","info__category");b(n.type,h),h.innerText=n.type;const C=c("p","info__name");C.innerText=n.name;const M=T(n.price,n.discount),f=c("p","info__price");n.type==="Sale%"?(f.innerHTML=`<span>$${n.price}</span> $${M}`,$(f,"add","info__price_sale")):f.innerText=`$${n.price}`,l.appendChild(h),l.appendChild(C),l.appendChild(f),o.appendChild(s),n.type==="Sale%"&&o.appendChild(a),o.appendChild(l),r.appendChild(o),i.appendChild(r)})}function b(e,i){const t={"Vitamins & Dietary Supplements":"info__category_purple",Minerals:"info__category_green-mint","Prenatal Vitamins":"info__category_purple","Pain Relief":"info__category_blue",Antioxidants:"info__category_orange","Weight Loss":"info__category_dark-blue",Probiotics:"info__category_red","Sale%":"info__category_red"};t[e]&&$(i,"add",t[e])}function T(e,i){const t=parseFloat(e);if(isNaN(t))throw new Error("Invalid price format");return+(t*(1-i/100)).toFixed(2)}function v(e,i){const t=d(e);if(!t||t.children.length===0)return;const n=new IntersectionObserver(async(o,s)=>{const a=o[0];a.isIntersecting&&(s.disconnect(),console.log(a.isIntersecting),await L(e,i),v(e,i))},{threshold:1}),r=t.lastElementChild;r&&n.observe(r)}async function L(e,i){const t=d(e);if(!t)return;i!==p?(u=1,p=i,t.innerHTML=""):u++;const n=await y(u,_,i);if(n.errors||n.data.length===0){console.log(n.data.length);return}await w(n.data,t,"gray")}async function E(e,i){console.log(`Обновление кнопки: container=${e}, category=${i}`);const t=d(".catalog-list__view-more");if(!t)return;p=i,u=1;let n=await y(1,1,i);if(console.log(n),!W(n)||n.errors)return;const r=n.meta.totalItems,o=d(e);if(!o)return;let s=o.children.length,a=r-s;t.style.display=a>0?"flex":"none",t.replaceWith(t.cloneNode(!0));const l=d(".catalog-list__view-more");l.addEventListener("click",async()=>{a>0&&(await L(e,p),console.log(`Загрузка для категории: ${p}`),s=o.children.length,a=r-s,l.style.display=a>0?"flex":"none",console.log(`Осталось карточек: ${a}`))})}function W(e){return typeof e=="object"&&e!==null&&"data"in e&&Array.isArray(e.data)}export{D as a,A as r};
