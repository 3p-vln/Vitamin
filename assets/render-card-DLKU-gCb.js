import{j as x,m}from"./use-api-BnJ_j2Go.js";import{g as d,r as c,c as P}from"./use-call-dom-DDNnwvp7.js";import{s as y}from"./stopPreload-BW9xUuEZ.js";let f=1,u=10,_=6;const v=window.innerWidth;let g;async function H(n,o){const r=d(n);if(r)try{const e=await x(!1);if("errors"in e){console.error(e.errors);return}const t=e.data;await w(t,r,o),y()}catch(e){console.error(e)}}function M(){const n=window.innerWidth;n<375?(u=4,_=2):n<768?(u=6,_=6):(u=10,_=10)}async function R(n,o=1,r){M();const e=d(n);if(e)try{let t=await m(o,u,r);if("errors"in t){console.error(t.errors);return}if(t.errors||t.data.length===0){e.innerHTML="<p>Нет товаров в данной категории</p>";return}const i=t.data;await w(i,e,"gray"),v>=768&&L(n,r),v<768&&await S(n,r),y()}catch(t){console.error(t)}}async function w(n,o,r){n.forEach(e=>{const t=c("a",["prod-card",`${e.id}`,`prod-card_${r}`,"skeleton"]);t.href=`one-product.html?id=${e.id}`;const i=c("div","prod-card__content"),a=c("div","prod-card__img");a.innerHTML=`<picture><img src="${e.img}" alt="prod" /></picture>`;const s=c("div","prod-card__discount");s.innerText=`-${e.discount}%`;const l=c("div",["prod-card__info","info"]),h=c("p","info__category");b(e.type,h),h.innerText=e.type;const C=c("p","info__name");C.innerText=e.name;const $=E(e.price,e.discount),p=c("p","info__price");e.type==="Sale%"?(p.innerHTML=`<span>$${e.price}</span> $${$}`,P(p,"add","info__price_sale")):p.innerText=`$${e.price}`,l.appendChild(h),l.appendChild(C),l.appendChild(p),i.appendChild(a),e.type==="Sale%"&&i.appendChild(s),i.appendChild(l),t.appendChild(i),o.appendChild(t)})}function b(n,o){const r={"Vitamins & Dietary Supplements":"info__category_purple",Minerals:"info__category_green-mint","Prenatal Vitamins":"info__category_purple","Pain Relief":"info__category_blue",Antioxidants:"info__category_orange","Weight Loss":"info__category_dark-blue",Probiotics:"info__category_red","Sale%":"info__category_red"};r[n]&&P(o,"add",r[n])}function E(n,o){const r=parseFloat(n);if(isNaN(r))throw new Error("Invalid price format");return(r*(1-o/100)).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}function L(n,o){const r=d(n);if(!r||r.children.length===0)return;const e=new IntersectionObserver(async(i,a)=>{i[0].isIntersecting&&(a.disconnect(),await T(n,o),L(n,o))},{threshold:1}),t=r.lastElementChild;t&&e.observe(t)}async function T(n,o){const r=d(n);if(!r)return;const e=r.scrollTop,t=r.scrollHeight;r.style.height=t+"px",o!==g?(f=2,g=o):f++;try{const i=await m(f,_,o);if("errors"in i){console.error(i.errors);return}if(i.errors||i.data.length===0)return;await w(i.data,r,"gray"),y(),setTimeout(()=>{r.style.height="auto",r.scrollTop=e},0)}catch(i){console.error(i)}}async function S(n,o){const r=d(".catalog-list__view-more");if(r){g=o,f=1;try{let e=await m(1,1,o);if("errors"in e){console.error(e.errors);return}const t=e.meta.totalItems,i=d(n);if(!i)return;let a=i.children.length,s=t-a;r.style.display=s>0?"flex":"none",r.replaceWith(r.cloneNode(!0));const l=d(".catalog-list__view-more");l.addEventListener("click",async()=>{s>0&&(await T(n,g),a=i.children.length,s=t-a,l.style.display=s>0?"flex":"none")})}catch(e){console.error(e)}}}export{R as a,S as h,H as r,L as s};
