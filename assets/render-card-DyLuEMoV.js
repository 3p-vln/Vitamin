import{g as x,j as m}from"./use-api-DMCIcZDv.js";import{g as d,r as c,c as M}from"./use-call-dom-CaqOo_cc.js";import{s as y,o as b}from"./lazy-load-V4MgisZy.js";let g=1,u=10,_=6;const $=window.innerWidth;let h,C=!0;async function R(n,i){const e=d(n);if(e)try{const r=(await x(!1)).data;w(r,e,i),y()}catch(t){console.error(t)}}function D(){const n=window.innerWidth;if(n<375){u=4,_=2;return}if(n<768){u=6,_=6;return}u=10,_=10}async function B(n,i=1,e){D();const t=d(n);if(t)try{let r=await m(i,u,e);if(C=!0,r.errors||r.data.length===0){t.innerHTML="<p>Нет товаров в данной категории</p>";return}const o=r.data;w(o,t,"gray"),$>=768&&P(n,e),$<768&&await V(n,e),y()}catch(r){console.error(r)}}function w(n,i,e){n.forEach(t=>{const r=c("a",["prod-card",`${t.id}`,`prod-card_${e}`,"skeleton"]);r.href=`/Vitamin/one-product.html?id=${t.id}`;const o=c("div","prod-card__content"),a=c("div","prod-card__img");a.innerHTML=`
        <picture>
           <source srcset="${t.img.img_webp}" type="image/webp">
           <img src="${t.img.img_default}" alt="prod" width="${t.img.img_width}" height="${t.img.img_height}" loading="lazy"/>
        </picture>`;const s=c("div","prod-card__discount");s.innerText=`-${t.discount}%`;const l=c("div",["prod-card__info","info"]),p=c("p","info__category");E(t.type,p),p.innerText=t.type;const v=c("p","info__name");v.innerText=t.name;const T=S(t.price,t.discount),f=c("p","info__price");t.type==="Sale%"?(f.innerHTML=`<span>$${t.price}</span> $${T}`,M(f,"add","info__price_sale")):f.innerText=`$${t.price}`,l.appendChild(p),l.appendChild(v),l.appendChild(f),o.appendChild(a),t.type==="Sale%"&&o.appendChild(s),o.appendChild(l),r.appendChild(o),i.appendChild(r)})}function E(n,i){const e={"Vitamins & Dietary Supplements":"info__category_purple",Minerals:"info__category_green-mint","Prenatal Vitamins":"info__category_pink","Pain Relief":"info__category_blue",Antioxidants:"info__category_orange","Weight Loss":"info__category_dark-blue",Probiotics:"info__category_red","Sale%":"info__category_red"};e[n]&&M(i,"add",e[n])}function S(n,i){const e=parseFloat(n);if(isNaN(e))throw new Error("Invalid price format");return(e*(1-i/100)).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}function P(n,i){const e=d(n);if(!e||e.children.length===0)return;const t={callback:async(o,a)=>{o[0].isIntersecting&&(a.disconnect(),await L(n,i),C&&P(n,i))},options:{threshold:1}},r=e.lastElementChild;r&&b(r,t)}async function L(n,i){const e=d(n);if(!e)return;const t=e.scrollTop,r=e.scrollHeight;e.style.height=r+"px",i!==h?(g=2,h=i):g++;try{const o=await m(g,_,i);if(o.errors||o.data.length===0){C=!1;return}w(o.data,e,"gray"),y(),setTimeout(()=>{e.style.height="auto",e.scrollTop=t},0)}catch(o){console.error(o)}}async function V(n,i){const e=d(".catalog-list__view-more");if(e){h=i,g=1;try{const r=(await m(1,1,i)).meta.totalItems,o=d(n);if(!o)return;let a=o.children.length,s=r-a;e.style.display=s>0?"flex":"none",e.replaceWith(e.cloneNode(!0));const l=d(".catalog-list__view-more");l.addEventListener("click",async()=>{if(s>0)try{await L(n,h),a=o.children.length,s=r-a,l.style.display=s>0?"flex":"none"}catch(p){console.error(p)}})}catch(t){console.error(t)}}}export{B as a,V as h,R as r,P as s};
