import{b as l,a as s}from"./index-wYSWI2m-.js";const u="https://www.mku-journal.online",h="accessToken",i="refreshToken",f="/auth/refresh-token",o=l.create({baseURL:u,withCredentials:!0}),d=()=>s.get(h)||null,k=()=>s.get(i)||null,m=(e,t)=>{s.set(h,e,{path:"/"}),s.set(i,t,{path:"/",expires:1})},p=()=>{s.remove(h,{path:"/"}),s.remove(i,{path:"/"})};o.interceptors.request.use(e=>{const t=d();return t&&e.headers&&(e.headers.authorization=`${t}`),e},e=>Promise.reject(e));let a=!1,c=[];const w=e=>{c.push(e)},T=e=>{c.forEach(t=>t(e)),c=[]};o.interceptors.response.use(e=>e,async e=>{const t=e.config;if(e.response?.status===401&&!t._retry){if(a)return new Promise(r=>{w(n=>{t.headers&&(t.headers.authorization=`${n}`),r(o(t))})});t._retry=!0,a=!0;try{const r=k();if(!r)throw new Error("No refresh token available");const{data:n}=await o.post(f,{[i]:r});return m(n.accessToken,n.refreshToken),T(n.accessToken),t.headers&&(t.headers.authorization=`${n.accessToken}`),o(t)}catch(r){return p(),Promise.reject(r)}finally{a=!1}}return Promise.reject(e)});function R(){const e=s.get("accessToken"),t=window.location.pathname;if(!e&&!t.includes("/login.html")&&!t.includes("/registration.html")){window.location.href="/Vitamin/login.html";return}e&&(t.includes("/login.html")||t.includes("/registration.html"))?window.location.href="/Vitamin":document.body.style.visibility="visible"}export{o as a,R as c};
