import{g as r}from"./use-call-dom-DDNnwvp7.js";import{J as q}from"./just-validate.es-C73wyOde.js";import{m as b}from"./use-api-DGP1fZH4.js";import{I as M}from"./index-yFKSUj0c.js";async function _(){return new Promise(t=>{const p=r("#create-order");if(!p)return;const s=new q(p,{focusInvalidField:!0,lockForm:!1,validateBeforeSubmitting:!0});s.addField("#first-name",[{rule:"required",errorMessage:"This field is required"},{rule:"minLength",value:2,errorMessage:"Must be at least 2 characters"},{rule:"maxLength",value:50,errorMessage:"Must be less than 50 characters"},{rule:"customRegexp",value:/^[\p{L}]+$/u,errorMessage:"Only letters are allowed"}]).addField("#last-name",[{rule:"required",errorMessage:"This field is required"},{rule:"minLength",value:2,errorMessage:"Must be at least 2 characters"},{rule:"maxLength",value:50,errorMessage:"Must be less than 50 characters"},{rule:"customRegexp",value:/^[\p{L}]+$/u,errorMessage:"Only letters are allowed"}]).addField("#address-line1",[{rule:"required",errorMessage:"This field is required"},{rule:"minLength",value:5,errorMessage:"Must be at least 5 characters"},{rule:"maxLength",value:50,errorMessage:"Must be less than 50 characters"},{rule:"customRegexp",value:/^[\p{L}\d.,\s]+$/u,errorMessage:"Write correct address"}]).addField("#address-line2",[{rule:"minLength",value:5,errorMessage:"Must be at least 5 characters"},{rule:"maxLength",value:50,errorMessage:"Must be less than 50 characters"},{rule:"customRegexp",value:/^[\p{L}\d.,\s]+$/u,errorMessage:"Write correct address"}]).addField("#city",[{rule:"required",errorMessage:"This field is required"},{rule:"minLength",value:2,errorMessage:"Must be at least 2 characters"},{rule:"maxLength",value:50,errorMessage:"Must be less than 50 characters"},{rule:"customRegexp",value:/^[\p{L}]+$/u,errorMessage:"Enter a valid city name"}]).addField("#state",[{rule:"required",errorMessage:"This field is required"}]).addField("#zip",[{rule:"required",errorMessage:"This field is required"},{rule:"minLength",value:3,errorMessage:"Must be at least 3 characters"},{rule:"maxLength",value:10,errorMessage:"Must be less than 10 characters"},{rule:"customRegexp",value:/^\d+$/,errorMessage:"Enter a valid ZIP / Postal Code"}]).addField("#mail",[{rule:"required",errorMessage:"This field is required"},{rule:"customRegexp",value:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z]{2,})$/,errorMessage:"Write correct email"}]).addField("#phone",[{rule:"required",errorMessage:"This field is required"},{rule:"maxLength",value:19,errorMessage:"Must be less than 13 characters"}]).addField("#card",[{rule:"required",errorMessage:"This field is required"},{rule:"minLength",value:19,errorMessage:"Must be at least 16 characters"}]).addField("#expiration",[{rule:"required",errorMessage:"This field is required"},{rule:"minLength",value:5,errorMessage:"Must be at least 4 characters"}]).addField("#cvc",[{rule:"required",errorMessage:"This field is required"},{rule:"minLength",value:3,errorMessage:"Must be at least 3 characters"}]),s.validate(),s.onSuccess(()=>t(!0)),s.onFail(()=>t(!1))})}const I=r(".create-order-form__btn"),L=r(".order-list__btn"),e=JSON.parse(localStorage.getItem("userInfo")||"null"),a=JSON.parse(localStorage.getItem("orderInfo")||"null"),d=r("#first-name"),n=r("#last-name"),c=r("#address-line1"),m=r("#address-line2"),v=r("#city"),g=r("#state"),f=r("#zip"),h=r("#mail"),l=r("#phone"),u=r("#card"),o=r("#expiration"),i=r("#cvc");async function N(){!I||!L||(S(),F(),L.addEventListener("click",()=>{I.click()}),I.addEventListener("click",async()=>{await _()&&(y(),x())}))}function x(){e||(localStorage.removeItem("cartItems"),window.location.href="/Vitamin/successful-order.html");const t=JSON.parse(localStorage.getItem("cartItems")||"[]");if(t.length===0){console.log("Cart is empty!");return}console.log(e);const p={order:t.map(s=>({product_id:s.id,quantity:s.counts})),user_id:e.user_id};try{b(p).then(s=>{console.log("Order created successfully:",s),localStorage.removeItem("cartItems"),window.location.href="/Vitamin/successful-order.html"})}catch(s){console.error(s)}}function F(){!u||!o||!i||!l||(M(u,{mask:"0000-0000-0000-0000"}),M(o,{mask:"00/00"}),M(i,{mask:"000"}),M(l,{mask:"+000 (00) 00 00 000"}))}function y(){if(!d||!n||!c||!m||!v||!g||!f||!h||!l||!u||!o||!i)return;const t={firstName:d.value,lastName:n.value,addressFirst:c.value,addressSecond:m.value,city:v.value,state:g.value,zip:f.value,email:h.value,phone:l.value,card:u.value,date:o.value,cvc:i.value};console.log("Order created:",t),localStorage.setItem("orderInfo",JSON.stringify(t))}function S(){if(!(!d||!n||!c||!m||!v||!g||!f||!h||!l||!u||!o||!i)&&!(!e&&a)){if(a&&!e){d.value=a.firstName,n.value=a.lastName,c.value=a.addressFirst,m.value=a.addressSecond,v.value=a.city,g.value=a.state,f.value=a.zip,h.value=a.email,l.value=a.phone,u.value=a.card,o.value=a.expiration,i.value=a.cvc;return}if(e){console.log(e),d.value=e.first_name,n.value=e.last_name,c.value=e.address_one,m.value=e.address_two,v.value=e.city,g.value=e.state_province,f.value=e.postal_code,h.value=e.email,l.value=e.phone,u.value=e.card_info.card_number,o.value=e.card_info.card_date,i.value=e.card_info.card_cvv;return}}}export{N as default};
