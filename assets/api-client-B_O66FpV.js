import{a as u}from"./axios-B-d85qs8.js";import{a as o}from"./js.cookie-Cz0CWeBA.js";const f="https://www.mku-journal.online",h="accessToken",i="refreshToken",l="/auth/refresh-token",n=u.create({baseURL:f,withCredentials:!0}),p=()=>o.get(h)||null,k=()=>o.get(i)||null,m=(e,r)=>{o.set(h,e,{path:"/"}),o.set(i,r,{path:"/",expires:1})},E=()=>{o.remove(h,{path:"/"}),o.remove(i,{path:"/"}),localStorage.removeItem("userInfo"),window.location.href="/Vitamin/login.html"};n.interceptors.request.use(e=>{const r=p();return r&&e.headers&&(e.headers.authorization=`${r}`),e},e=>Promise.reject(e));let c=!1;const a=[],T=e=>{a.push(e)},R=e=>{a.forEach(r=>r(e)),a.splice(0,a.length)};n.interceptors.response.use(e=>e,async e=>{const r=e.config;if(e.response?.status===401&&!r._retry){if(c)return new Promise(t=>{T(s=>{r.headers&&(r.headers.authorization=`${s}`),t(n(r))})});r._retry=!0,c=!0;try{const t=k();if(!t)throw new Error("No refresh token available");const{data:s}=await n.post(l,{[i]:t});return m(s.accessToken,s.refreshToken),R(s.accessToken),r.headers&&(r.headers.authorization=`${s.accessToken}`),n(r)}catch(t){return E(),Promise.reject(t)}finally{c=!1}}return Promise.reject(e)});export{n as a};
