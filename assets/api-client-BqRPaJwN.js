import{b as u,a as o}from"./index-wYSWI2m-.js";const f="https://www.mku-journal.online",h="accessToken",i="refreshToken",l="/auth/refresh-token",n=u.create({baseURL:f,withCredentials:!0}),k=()=>o.get(h)||null,p=()=>o.get(i)||null,E=(e,s)=>{o.set(h,e,{path:"/"}),o.set(i,s,{path:"/",expires:1})};n.interceptors.request.use(e=>{const s=k();return s&&e.headers&&(e.headers.authorization=`${s}`),e},e=>Promise.reject(e));let a=!1,c=[];const T=e=>{c.push(e)},R=e=>{c.forEach(s=>s(e)),c=[]};n.interceptors.response.use(e=>e,async e=>{const s=e.config;if(e.response?.status===401&&!s._retry){if(a)return new Promise(r=>{T(t=>{s.headers&&(s.headers.authorization=`${t}`),r(n(s))})});s._retry=!0,a=!0;try{const r=p();if(!r)throw new Error("No refresh token available");const{data:t}=await n.post(l,{[i]:r});return E(t.accessToken,t.refreshToken),R(t.accessToken),s.headers&&(s.headers.authorization=`${t.accessToken}`),n(s)}catch(r){return Promise.reject(r)}finally{a=!1}}return Promise.reject(e)});export{n as a};
