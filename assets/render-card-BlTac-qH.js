import{i as x,k as y}from"./use-api-AcE-7l2M.js";import{g as d,r as c,c as $}from"./use-call-dom-DDNnwvp7.js";import{s as m}from"./lazy-load-CcXlw6so.js";let f=1,u=10,_=6;const P=window.innerWidth;let g,w=!0;async function k(n,o){const r=d(n);if(r)try{const e=await x(!1);if("errors"in e){console.error(e.errors);return}const t=e.data;await C(t,r,o),m()}catch(e){console.error(e)}}function b(){const n=window.innerWidth;n<375?(u=4,_=2):n<768?(u=6,_=6):(u=10,_=10)}async function R(n,o=1,r){b();const e=d(n);if(e)try{let t=await y(o,u,r);if(w=!0,"errors"in t){console.error(t.errors);return}if(t.errors||t.data.length===0){e.innerHTML="<p>Нет товаров в данной категории</p>";return}const i=t.data;await C(i,e,"gray"),P>=768&&L(n,r),P<768&&await S(n,r),m()}catch(t){console.error(t)}}async function C(n,o,r){n.forEach(e=>{const t=c("a",["prod-card",`${e.id}`,`prod-card_${r}`,"skeleton"]);t.href=`one-product.html?id=${e.id}`;const i=c("div","prod-card__content"),a=c("div","prod-card__img");a.innerHTML=`
        <picture>
           <source srcset="${e.img_webp}" type="image/webp">
           <img src="${e.img}" alt="prod" />
        </picture>`;const s=c("div","prod-card__discount");s.innerText=`-${e.discount}%`;const l=c("div",["prod-card__info","info"]),h=c("p","info__category");D(e.type,h),h.innerText=e.type;const v=c("p","info__name");v.innerText=e.name;const T=E(e.price,e.discount),p=c("p","info__price");e.type==="Sale%"?(p.innerHTML=`<span>$${e.price}</span> $${T}`,$(p,"add","info__price_sale")):p.innerText=`$${e.price}`,l.appendChild(h),l.appendChild(v),l.appendChild(p),i.appendChild(a),e.type==="Sale%"&&i.appendChild(s),i.appendChild(l),t.appendChild(i),o.appendChild(t)})}function D(n,o){const r={"Vitamins & Dietary Supplements":"info__category_purple",Minerals:"info__category_green-mint","Prenatal Vitamins":"info__category_purple","Pain Relief":"info__category_blue",Antioxidants:"info__category_orange","Weight Loss":"info__category_dark-blue",Probiotics:"info__category_red","Sale%":"info__category_red"};r[n]&&$(o,"add",r[n])}function E(n,o){const r=parseFloat(n);if(isNaN(r))throw new Error("Invalid price format");return(r*(1-o/100)).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}function L(n,o){const r=d(n);if(!r||r.children.length===0)return;const e=new IntersectionObserver(async(i,a)=>{i[0].isIntersecting&&(a.disconnect(),await M(n,o),w&&L(n,o))},{threshold:1}),t=r.lastElementChild;t&&e.observe(t)}async function M(n,o){const r=d(n);if(!r)return;const e=r.scrollTop,t=r.scrollHeight;r.style.height=t+"px",o!==g?(f=2,g=o):f++;try{const i=await y(f,_,o);if("errors"in i){console.error(i.errors);return}if(i.errors||i.data.length===0){w=!1;return}await C(i.data,r,"gray"),m(),setTimeout(()=>{r.style.height="auto",r.scrollTop=e},0)}catch(i){console.error(i)}}async function S(n,o){const r=d(".catalog-list__view-more");if(r){g=o,f=1;try{let e=await y(1,1,o);if("errors"in e){console.error(e.errors);return}const t=e.meta.totalItems,i=d(n);if(!i)return;let a=i.children.length,s=t-a;r.style.display=s>0?"flex":"none",r.replaceWith(r.cloneNode(!0));const l=d(".catalog-list__view-more");l.addEventListener("click",async()=>{s>0&&(await M(n,g),a=i.children.length,s=t-a,l.style.display=s>0?"flex":"none")})}catch(e){console.error(e)}}}export{R as a,S as h,k as r,L as s};
