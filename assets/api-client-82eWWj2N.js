import{h as u}from"./use-api-CoVlJz1c.js";import{a as o}from"./js.cookie-Cz0CWeBA.js";const f="https://www.mku-journal.online",h="accessToken",c="refreshToken",l="/auth/refresh-token",n=u.create({baseURL:f,withCredentials:!0}),p=()=>o.get(h)||null,k=()=>o.get(c)||null,m=(e,r)=>{o.set(h,e,{path:"/"}),o.set(c,r,{path:"/",expires:1})},E=()=>{o.remove(h,{path:"/"}),o.remove(c,{path:"/"}),localStorage.removeItem("userInfo")};n.interceptors.request.use(e=>{const r=p();return r&&e.headers&&(e.headers.authorization=`${r}`),e},e=>Promise.reject(e));let i=!1;const a=[],T=e=>{a.push(e)},R=e=>{a.forEach(r=>r(e)),a.splice(0,a.length)};n.interceptors.response.use(e=>e,async e=>{const r=e.config;if(e.response?.status===401&&!r._retry){if(i)return new Promise(s=>{T(t=>{r.headers&&(r.headers.authorization=`${t}`),s(n(r))})});r._retry=!0,i=!0;try{const s=k();if(!s)throw new Error("No refresh token available");const{data:t}=await n.post(l,{[c]:s});return m(t.accessToken,t.refreshToken),R(t.accessToken),r.headers&&(r.headers.authorization=`${t.accessToken}`),n(r)}catch(s){return E(),Promise.reject(s)}finally{i=!1}}return Promise.reject(e)});export{n as a};
