import{g as x,k as m}from"./use-api-CoVlJz1c.js";import{g as d,r as c,c as P}from"./use-call-dom-8Q8ZjlCD.js";import{s as y}from"./lazy-load-C3ije9Oq.js";let u=1,g=10,_=6;const $=window.innerWidth;let h,w=!0;async function k(t,o){const r=d(t);if(r)try{const e=await x(!1);if("errors"in e){console.error(e.errors);return}const n=e.data;C(n,r,o),y()}catch(e){console.error(e)}}function b(){const t=window.innerWidth;t<375?(g=4,_=2):t<768?(g=6,_=6):(g=10,_=10)}async function R(t,o=1,r){b();const e=d(t);if(e)try{let n=await m(o,g,r);if(w=!0,"errors"in n){console.error(n.errors);return}if(n.errors||n.data.length===0){e.innerHTML="<p>Нет товаров в данной категории</p>";return}const i=n.data;C(i,e,"gray"),$>=768&&L(t,r),$<768&&await S(t,r),y()}catch(n){console.error(n)}}function C(t,o,r){t.forEach(e=>{const n=c("a",["prod-card",`${e.id}`,`prod-card_${r}`,"skeleton"]);n.href=`/Vitamin/one-product.html?id=${e.id}`;const i=c("div","prod-card__content"),a=c("div","prod-card__img");a.innerHTML=`
        <picture>
           <source srcset="${e.img.img_webp}" type="image/webp">
           <img src="${e.img.img_default}" alt="prod" width="${e.img.img_width}" height="${e.img.img_height}" />
        </picture>`;const s=c("div","prod-card__discount");s.innerText=`-${e.discount}%`;const l=c("div",["prod-card__info","info"]),p=c("p","info__category");D(e.type,p),p.innerText=e.type;const v=c("p","info__name");v.innerText=e.name;const T=E(e.price,e.discount),f=c("p","info__price");e.type==="Sale%"?(f.innerHTML=`<span>$${e.price}</span> $${T}`,P(f,"add","info__price_sale")):f.innerText=`$${e.price}`,l.appendChild(p),l.appendChild(v),l.appendChild(f),i.appendChild(a),e.type==="Sale%"&&i.appendChild(s),i.appendChild(l),n.appendChild(i),o.appendChild(n)})}function D(t,o){const r={"Vitamins & Dietary Supplements":"info__category_purple",Minerals:"info__category_green-mint","Prenatal Vitamins":"info__category_purple","Pain Relief":"info__category_blue",Antioxidants:"info__category_orange","Weight Loss":"info__category_dark-blue",Probiotics:"info__category_red","Sale%":"info__category_red"};r[t]&&P(o,"add",r[t])}function E(t,o){const r=parseFloat(t);if(isNaN(r))throw new Error("Invalid price format");return(r*(1-o/100)).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}function L(t,o){const r=d(t);if(!r||r.children.length===0)return;const e=new IntersectionObserver(async(i,a)=>{i[0].isIntersecting&&(a.disconnect(),await M(t,o),w&&L(t,o))},{threshold:1}),n=r.lastElementChild;n&&e.observe(n)}async function M(t,o){const r=d(t);if(!r)return;const e=r.scrollTop,n=r.scrollHeight;r.style.height=n+"px",o!==h?(u=2,h=o):u++;try{const i=await m(u,_,o);if("errors"in i){console.error(i.errors);return}if(i.errors||i.data.length===0){w=!1;return}C(i.data,r,"gray"),y(),setTimeout(()=>{r.style.height="auto",r.scrollTop=e},0)}catch(i){console.error(i)}}async function S(t,o){const r=d(".catalog-list__view-more");if(r){h=o,u=1;try{let e=await m(1,1,o);if("errors"in e){console.error(e.errors);return}const n=e.meta.totalItems,i=d(t);if(!i)return;let a=i.children.length,s=n-a;r.style.display=s>0?"flex":"none",r.replaceWith(r.cloneNode(!0));const l=d(".catalog-list__view-more");l.addEventListener("click",async()=>{if(s>0)try{await M(t,h),a=i.children.length,s=n-a,l.style.display=s>0?"flex":"none"}catch(p){console.error(p)}})}catch(e){console.error(e)}}}export{R as a,S as h,k as r,L as s};
