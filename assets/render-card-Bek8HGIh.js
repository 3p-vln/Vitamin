import{g as x,k as m}from"./use-api-CoVlJz1c.js";import{g as d,r as c,c as M}from"./use-call-dom-8Q8ZjlCD.js";import{s as y,o as b}from"./lazy-load-3l2UQROd.js";let g=1,u=10,_=6;const $=window.innerWidth;let h,C=!0;async function R(n,r){const e=d(n);if(e)try{const i=(await x(!1)).data;w(i,e,r),y()}catch(t){console.error(t)}}function D(){const n=window.innerWidth;if(n<375){u=4,_=2;return}if(n<768){u=6,_=6;return}u=10,_=10}async function B(n,r=1,e){D();const t=d(n);if(t)try{let i=await m(r,u,e);if(C=!0,i.errors||i.data.length===0){t.innerHTML="<p>Нет товаров в данной категории</p>";return}const o=i.data;w(o,t,"gray"),$>=768&&P(n,e),$<768&&await V(n,e),y()}catch(i){console.error(i)}}function w(n,r,e){n.forEach(t=>{const i=c("a",["prod-card",`${t.id}`,`prod-card_${e}`,"skeleton"]);i.href=`/Vitamin/one-product.html?id=${t.id}`;const o=c("div","prod-card__content"),a=c("div","prod-card__img");a.innerHTML=`
        <picture>
           <source srcset="${t.img.img_webp}" type="image/webp">
           <img src="${t.img.img_default}" alt="prod" width="${t.img.img_width}" height="${t.img.img_height}" />
        </picture>`;const s=c("div","prod-card__discount");s.innerText=`-${t.discount}%`;const l=c("div",["prod-card__info","info"]),p=c("p","info__category");E(t.type,p),p.innerText=t.type;const v=c("p","info__name");v.innerText=t.name;const T=S(t.price,t.discount),f=c("p","info__price");t.type==="Sale%"?(f.innerHTML=`<span>$${t.price}</span> $${T}`,M(f,"add","info__price_sale")):f.innerText=`$${t.price}`,l.appendChild(p),l.appendChild(v),l.appendChild(f),o.appendChild(a),t.type==="Sale%"&&o.appendChild(s),o.appendChild(l),i.appendChild(o),r.appendChild(i)})}function E(n,r){const e={"Vitamins & Dietary Supplements":"info__category_purple",Minerals:"info__category_green-mint","Prenatal Vitamins":"info__category_purple","Pain Relief":"info__category_blue",Antioxidants:"info__category_orange","Weight Loss":"info__category_dark-blue",Probiotics:"info__category_red","Sale%":"info__category_red"};e[n]&&M(r,"add",e[n])}function S(n,r){const e=parseFloat(n);if(isNaN(e))throw new Error("Invalid price format");return(e*(1-r/100)).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}function P(n,r){const e=d(n);if(!e||e.children.length===0)return;const t={callback:async(o,a)=>{o[0].isIntersecting&&(a.disconnect(),await L(n,r),C&&P(n,r))},options:{threshold:1}},i=e.lastElementChild;i&&b(i,t)}async function L(n,r){const e=d(n);if(!e)return;const t=e.scrollTop,i=e.scrollHeight;e.style.height=i+"px",r!==h?(g=2,h=r):g++;try{const o=await m(g,_,r);if(o.errors||o.data.length===0){C=!1;return}w(o.data,e,"gray"),y(),setTimeout(()=>{e.style.height="auto",e.scrollTop=t},0)}catch(o){console.error(o)}}async function V(n,r){const e=d(".catalog-list__view-more");if(e){h=r,g=1;try{const i=(await m(1,1,r)).meta.totalItems,o=d(n);if(!o)return;let a=o.children.length,s=i-a;e.style.display=s>0?"flex":"none",e.replaceWith(e.cloneNode(!0));const l=d(".catalog-list__view-more");l.addEventListener("click",async()=>{if(s>0)try{await L(n,h),a=o.children.length,s=i-a,l.style.display=s>0?"flex":"none"}catch(p){console.error(p)}})}catch(t){console.error(t)}}}export{B as a,V as h,R as r,P as s};
