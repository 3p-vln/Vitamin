import"./style-DFxU1QKQ.js";import{J as v}from"./just-validate.es-C73wyOde.js";import{a as L,A as M}from"./index-BBT-V0FT.js";function T(){const e=document.getElementById("wholesale-registration-file"),r=document.getElementById("wholesale-registration-file-description-pc"),t=document.getElementById("wholesale-registration-file-name"),s=document.getElementById("registration-add-file-btn"),a=document.getElementById("wholesale-registration-submit-btn");e&&e.addEventListener("change",()=>{e.files&&e.files.length>0&&(window.innerWidth>=567&&r?r.textContent=e.files[0].name:(t.textContent=e.files[0].name,t.style.opacity="1"))}),s&&e&&s.addEventListener("click",()=>{e.click()}),e&&a&&e.addEventListener("change",()=>{a.classList.remove("registration-form__submit_disabled"),a.disabled=!1})}function _(){const e=document.getElementById("auth-card"),r=document.getElementById("regular-reg"),t=document.getElementById("wholesale-reg"),s=document.querySelector(".registration-form__error-message");e&&r&&t&&(r.addEventListener("click",()=>{t.classList.remove("registration__nav-btn_active"),r.classList.add("registration__nav-btn_active"),e.classList.add("flipped");const a=document.getElementById("regular-registration");a instanceof HTMLFormElement&&a.reset(),s instanceof HTMLSpanElement&&(s.innerText="")}),t.addEventListener("click",()=>{t.classList.add("registration__nav-btn_active"),r.classList.remove("registration__nav-btn_active"),e.classList.remove("flipped");const a=document.getElementById("wholesale-registration");a instanceof HTMLFormElement&&a.reset();const o=document.getElementById("wholesale-registration-file-name");o&&(o.innerHTML="Permission",o.style.opacity="0.3");const n=document.getElementById("wholesale-registration-file-description-pc");n&&(n.innerHTML="Wholesale purchase permission",n.style.opacity="0.3");const i=document.getElementById("wholesale-registration-submit-btn");i instanceof HTMLButtonElement&&(i.disabled=!0,i.classList.add("registration-form__submit_disabled")),s instanceof HTMLSpanElement&&(s.innerText="")}))}/*! js-cookie v3.0.5 | MIT */function d(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var s in t)e[s]=t[s]}return e}var b={read:function(e){return e[0]==='"'&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function f(e,r){function t(a,o,n){if(!(typeof document>"u")){n=d({},r,n),typeof n.expires=="number"&&(n.expires=new Date(Date.now()+n.expires*864e5)),n.expires&&(n.expires=n.expires.toUTCString()),a=encodeURIComponent(a).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var i="";for(var l in n)n[l]&&(i+="; "+l,n[l]!==!0&&(i+="="+n[l].split(";")[0]));return document.cookie=a+"="+e.write(o,a)+i}}function s(a){if(!(typeof document>"u"||arguments.length&&!a)){for(var o=document.cookie?document.cookie.split("; "):[],n={},i=0;i<o.length;i++){var l=o[i].split("="),E=l.slice(1).join("=");try{var m=decodeURIComponent(l[0]);if(n[m]=e.read(E,m),a===m)break}catch{}}return a?n[a]:n}}return Object.create({set:t,get:s,remove:function(a,o){t(a,"",d({},o,{expires:-1}))},withAttributes:function(a){return f(this.converter,d({},this.attributes,a))},withConverter:function(a){return f(d({},this.converter,a),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(e)}})}var u=f(b,{path:"/"});const x="https://www.mku-journal.online",w="accessToken",p="refreshToken",F="/auth/refresh-token",c=L.create({baseURL:x,withCredentials:!0}),I=()=>u.get(w)||null,k=()=>u.get(p)||null,R=(e,r)=>{u.set(w,e,{path:"/"}),u.set(p,r,{path:"/",expires:1})};c.interceptors.request.use(e=>{const r=I();return r&&e.headers&&(e.headers.authorization=`${r}`),e},e=>Promise.reject(e));let g=!1,h=[];const q=e=>{h.push(e)},B=e=>{h.forEach(r=>r(e)),h=[]};c.interceptors.response.use(e=>e,async e=>{const r=e.config;if(e.response?.status===401&&!r._retry){if(g)return new Promise(t=>{q(s=>{r.headers&&(r.headers.authorization=`${s}`),t(c(r))})});r._retry=!0,g=!0;try{const t=k();if(!t)throw new Error("No refresh token available");const{data:s}=await c.post(F,{[p]:t});return R(s.accessToken,s.refreshToken),B(s.accessToken),r.headers&&(r.headers.authorization=`${s.accessToken}`),c(r)}catch(t){return Promise.reject(t)}finally{g=!1}}return Promise.reject(e)});async function y(e){try{const t=await c.post("/auth/register",e);t.status===201&&u.set("refreshToken",t.data.user.refreshToken,{path:"/"})}catch(t){if(t instanceof M&&t.response){const s=document.querySelector(".registration-form__regular-error-message");s&&(t.response.data.message==="Користувач вже зареєстрований"?s.innerHTML="The user is already registered":s.innerHTML="Error, try again later")}return}const r=await c.get("/profile/info");"email"in r.data&&(localStorage.setItem("userInfo",JSON.stringify(r.data)),window.location.href="/Vitamin")}function C(){new v("#regular-registration").addField("#regular-registration-email",[{rule:"required",errorMessage:"Email is required"},{rule:"email",errorMessage:"Enter a valid email address"}]).addField("#regular-registration-first-name",[{rule:"required",errorMessage:"Name required"},{rule:"minLength",value:2,errorMessage:"The name must contain a minimum of 2 characters"},{rule:"maxLength",value:30,errorMessage:"The name must not exceed 30 characters"},{rule:"customRegexp",value:/^[A-Za-zА-Яа-яЁё]+$/,errorMessage:"The name must contain only letters"}]).addField("#regular-registration-last-name",[{rule:"required",errorMessage:"Last name required"},{rule:"minLength",value:2,errorMessage:"Last name must contain a minimum of 2 characters"},{rule:"maxLength",value:30,errorMessage:"Last name must not exceed 30 characters"},{rule:"customRegexp",value:/^[A-Za-zА-Яа-яЁё]+$/,errorMessage:"The name must contain only letters"}]).addField("#regular-registration-password",[{rule:"required",errorMessage:"Password required"},{rule:"minLength",value:8,errorMessage:"Password must contain a minimum of 8 characters"},{rule:"maxLength",value:50,errorMessage:"Password must not exceed 50 characters"},{rule:"customRegexp",value:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).+$/,errorMessage:"The password must contain at least one uppercase letter, one lowercase letter, and one number"}]).onSuccess(async()=>{const r=document.getElementById("regular-registration"),t=new FormData(r),s={role_type:"regular"};for(let[a,o]of t.entries())s[a]=o;await y(s)})}function P(){new v("#wholesale-registration").addField("#wholesale-registration-email",[{rule:"required",errorMessage:"Email is required"},{rule:"email",errorMessage:"Invalid email format"}]).addField("#wholesale-registration-first-name",[{rule:"required",errorMessage:"First name is required"},{rule:"minLength",value:2,errorMessage:"First name must be at least 2 characters"},{rule:"maxLength",value:30,errorMessage:"First name must be at most 30 characters"},{rule:"customRegexp",value:/^[A-Za-zА-Яа-яЁё]+$/,errorMessage:"First name must contain only letters"}]).addField("#wholesale-registration-last-name",[{rule:"required",errorMessage:"Last name is required"},{rule:"minLength",value:2,errorMessage:"Last name must be at least 2 characters"},{rule:"maxLength",value:30,errorMessage:"Last name must be at most 30 characters"},{rule:"customRegexp",value:/^[A-Za-zА-Яа-яЁё]+$/,errorMessage:"Last name must contain only letters"}]).addField("#wholesale-registration-password",[{rule:"required",errorMessage:"Password is required"},{rule:"minLength",value:6,errorMessage:"Password must be at least 6 characters"},{rule:"maxLength",value:50,errorMessage:"Password must be at most 50 characters"},{rule:"customRegexp",value:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).+$/,errorMessage:"Password must contain at least one uppercase letter, one lowercase letter, and one number"}]).addField("#wholesale-registration-file",[{rule:"required",errorMessage:"File is required"},{validator:()=>{const r=document.querySelector("#wholesale-registration-file");return!r.files||r.files.length===0?!1:["image/jpeg","image/png","image/webp"].includes(r.files[0].type)},errorMessage:"Only image files (JPG, JPEG, PNG, webp) are allowed"}]).onSuccess(async()=>{const r=document.getElementById("wholesale-registration"),t=new FormData(r),s={role_type:"whosale"};for(let[a,o]of t.entries())s[a]=o;await y(s)})}document.addEventListener("DOMContentLoaded",async()=>{T(),_(),C(),P()});
