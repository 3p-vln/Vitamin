import{g as s,a as v,c as d,r as a}from"./use-call-dom-DDNnwvp7.js";import{i as z}from"./dropdown-7a_ekS_C.js";import{g as w}from"./use-api-DGP1fZH4.js";async function j(t){let e=null;if(typeof t=="string"?e=s(t):e=t,!e)return;const n=s(".counter__plus",e),o=s(".counter__minus",e),r=s(".counter__items",e);let i=Number(r?.innerText);!r||!n||!o||(T(n,o,i),o.addEventListener("click",()=>{q(r,i),i=Number(r?.innerText),T(n,o,i)}),n.addEventListener("click",()=>{G(r,i),i=Number(r?.innerText),T(n,o,i)}),E(r,i))}function E(t,e){t.textContent=e.toString()}function q(t,e){e>1&&(e--,E(t,e))}function G(t,e){e<999&&(e++,E(t,e))}function T(t,e,n){n!==999&&n!==1&&(t.style.opacity="1",e.style.opacity="1"),n===999&&(t.style.opacity="0.3"),n===1&&(e.style.opacity="0.3")}const A=s(".header__bag"),f=s(".cart"),B=s(".cart__close"),J=s(".cart__bg"),_=s(".cart__items"),O=JSON.parse(localStorage.getItem("userInfo")||"[]");let W=v(".prod"),l;const I=s(".info__backbtn");async function st(){!A||!B||!J||!_||(A.addEventListener("click",t=>K(t)),B.addEventListener("click",()=>F()),J.addEventListener("click",()=>F()),D(),u(),W.forEach(t=>{const e=s(".prod__autoship-text",t);e&&Z(e)}))}function K(t){t.stopPropagation(),f&&(d(f,"add","cart_active"),I&&(I.style.zIndex="1"),H())}function F(){f&&(d(f,"remove","cart_active"),I&&(I.style.zIndex="25"),H())}function Q(t){let e=JSON.parse(localStorage.getItem("cartItems")||"[]");e.some(o=>o.id===t)&&e.forEach(async o=>{const r=s(`.prod_${o.id}`);if(!r)return;const i=s(".prod__close",r);i&&i.addEventListener("click",()=>{r.remove(),X(t)})})}function X(t){let e=JSON.parse(localStorage.getItem("cartItems")||"[]");if(e=e.filter(n=>n.id!==t),localStorage.setItem("cartItems",JSON.stringify(e)),u(),g(),e.length===0){if(s(".cart__empty"))return;l=!0,h(l),u();return}}function H(){if(!f)return;const t=s("body"),e=s("header");if(!t||!e)return;const n=window.innerWidth-document.documentElement.clientWidth,o=window.scrollY,r=s(".info__backbtn");if(f.classList.contains("cart_active")){t.style.position="fixed",t.style.top=`-${o}px`,t.style.left="0",t.style.width="100%",t.style.overflow="hidden",t.style.paddingRight=`${n}px`,e.style.paddingRight=`${n}px`,o>50&&r&&(r.style.opacity="0");return}const i=Math.abs(parseInt(t.style.top,10))||0;t.style.position="",t.style.top="",t.style.left="",t.style.width="",t.style.overflow="",t.style.paddingRight="",e.style.paddingRight="",r&&(r.style.opacity=""),window.scrollTo(0,i)}function Z(t){window.innerWidth<768&&(t.innerText="Deliver every")}function C(t,e=!1,n="30",o=1){if(!_)return;const r=a("div",["cart__item","prod",`prod_${t.id}`]),i=a("a","prod__img");i.href=`/Vitamin/one-product.html?id=${t.id}`,t.type==="Vitamins & Dietary Supplements"&&d(i,"add","prod__img_purple"),t.type==="Minerals"&&d(i,"add","prod__img_green-mint"),t.type==="Prenatal Vitamins"&&d(i,"add","prod__img_pink"),t.type==="Pain Relief"&&d(i,"add","prod__img_blue"),t.type==="Antioxidants"&&d(i,"add","prod__img_orange"),t.type==="Weight Loss"&&d(i,"add","prod__img_dark-blue"),(t.type==="Probiotics"||t.type==="Sale%")&&d(i,"add","prod__img_red"),i.innerHTML=`
    <img src="${t.img}" alt="prod" />
  `;const c=a("div","prod__info"),p=a("div","prod__title-and-close"),y=a("a","prod__title");y.href=`/Vitamin/one-product.html?id=${t.id}`,y.innerText=t.name;const x=a("div","prod__close");x.innerHTML=`
    <span></span>
    <span></span>
  `;const $=a("div","prod__counter-and-price"),S=a("div","prod__counter");S.innerHTML=`
    <button class="counter__minus">
      <svg>
        <use href="#minus"></use>
      </svg>
    </button>
    <p class="counter__items">${o}</p>
    <button class="counter__plus">
      <svg>
        <use href="#plus"></use>
      </svg>
    </button>
  `,j(S);const b=a("p","prod__price"),U=N(t.price,t.discount,o),P=L(t.price,o);t.type==="Sale%"?(d(b,"add","prod__price_sale"),b.innerHTML=`<span>$${P}</span> $${U}`):b.innerText=`$${P}`;const k=a("div","prod__autoship");k.innerHTML=`
    <div class="prod__checkbox">
      <input type="checkbox" name="autoship" ${e?"checked":""}/>
      <span></span>
    </div>
    <p class="prod__autoship-text">Autoship every</p>
    <div class="dropdown">
      <div class="dropdown__box">
        <p class="dropdown__text">${n}</p>
        <div class="dropdown__arrow">
          <svg>
            <use href="#back-arrow"></use>
          </svg>
        </div>
      </div>
      <div class="dropdown__list">
        <button class="dropdown__item">10</button>
        <button class="dropdown__item">20</button>
        <button class="dropdown__item">30</button>
        <button class="dropdown__item">40</button>
        <button class="dropdown__item">50</button>
        <button class="dropdown__item">60</button>
      </div>
    </div>
    days
  `,z(k),p.appendChild(y),p.appendChild(x),$.appendChild(S),$.appendChild(b),c.appendChild(p),c.appendChild($),c.appendChild(k),r.appendChild(i),r.appendChild(c),_.appendChild(r),l=!1,h(l);const V=s(".autoship__on-off"),Y=s(".count__items");!V||!Y?et(t):tt(t),Q(t.id),R(t)}function N(t,e,n){const o=parseFloat(t);if(isNaN(o))throw new Error("Invalid price format");return(o*(1-e/100)*n).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}function L(t,e){const n=parseFloat(t);if(isNaN(n))throw new Error("Invalid price format");return(n*e).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}function tt(t){let e=JSON.parse(localStorage.getItem("cartItems")||"[]");const n=e.some(p=>p.id===t.id),o=s(".autoship__on-off"),r=s(".count__items");if(!o||!r)return;const i=o.classList.contains("autoship__on-off_active")||!1,c=Number(r.innerText);n||e.push({id:t.id,autoshipChecked:i,autoshipDays:"30",counts:c}),localStorage.setItem("cartItems",JSON.stringify(e))}function et(t){let e=JSON.parse(localStorage.getItem("cartItems")||"[]");e.some(o=>o.id===t.id)||e.push({id:t.id,autoshipChecked:!0,autoshipDays:"30",counts:1}),localStorage.setItem("cartItems",JSON.stringify(e))}function R(t){const e=s(`.prod_${t.id} .prod__checkbox input`),n=s(`.prod_${t.id} .dropdown__text`),o=v(`.prod_${t.id} .dropdown__item`),r=s(`.prod_${t.id} .counter__minus`),i=s(`.prod_${t.id} .counter__plus`),c=s(`.prod_${t.id} .counter__items`);!e||!n||!o||!r||!i||!c||(e&&e.addEventListener("change",()=>{m(`${t.id}`,e.checked,n.textContent||"30",Number(c.textContent))}),n&&o.forEach(p=>{p.addEventListener("click",y=>{const x=y.target.textContent||"30";m(`${t.id}`,e.checked,x,Number(c.textContent))})}),r.addEventListener("click",()=>{M(t,Number(c.textContent)),m(`${t.id}`,e.checked,n.textContent||"30",Number(c.textContent)),u()}),i.addEventListener("click",()=>{M(t,Number(c.textContent)),m(`${t.id}`,e.checked,n.textContent||"30",Number(c.textContent)),u()}))}function M(t,e){const n=N(t.price,t.discount,e),o=L(t.price,e),r=s(`.prod_${t.id} .prod__price`);r&&(t.type==="Sale%"?r.innerHTML=`<span>$${o}</span> $${n}`:r.innerText=`$${o}`)}function m(t,e,n,o){let r=JSON.parse(localStorage.getItem("cartItems")||"[]");const i=r.findIndex(c=>c.id===Number(t));i!==-1&&(r[i].autoshipChecked=e,r[i].autoshipDays=n,r[i].counts=o),localStorage.setItem("cartItems",JSON.stringify(r))}function D(){const t=JSON.parse(localStorage.getItem("cartItems")||"[]");if(t.length===0){l=!0,h(l),g();return}l=!1,h(l),g(),_&&(_.innerHTML="",t.forEach(async e=>{try{const n=await w(`${e.id}`);if("errors"in n){console.error(n.errors);return}C(n,e.autoshipChecked,e.autoshipDays,e.counts),R(n),W=v(".prod")}catch(n){console.error(n)}}))}function ct(t){let e=JSON.parse(localStorage.getItem("cartItems")||"[]");e.length===0&&(l=!0,h(l)),e.some(o=>o.id===t.id)||C(t),u(),g()}function at(t){if(!t.disabled_subscribe)return;const e=s(`.prod_${t.id} .prod__checkbox input`),n=s(`.prod_${t.id} .dropdown__text`),o=s(".autoship__dropdown .dropdown__text");if(!o)return;const r=o.textContent,i=s(`.prod_${t.id} .counter__items`);!e||!n||!r||!i||(e.checked=!0,n.innerText=r,m(`${t.id}`,e.checked,n.textContent||"30",Number(i.textContent)))}function dt(t){if(!t.disabled_subscribe)return;const e=s(`.prod_${t.id} .prod__checkbox input`),n=s(`.prod_${t.id} .dropdown__text`),o=s(`.prod_${t.id} .counter__items`);!e||!n||!o||(e.checked=!1,m(`${t.id}`,e.checked,n.textContent||"30",Number(o.textContent)))}function lt(t){const e=s(`.prod_${t.id} .prod__checkbox input`),n=s(`.prod_${t.id} .dropdown__text`),o=s(`.prod_${t.id} .counter__items`),r=s(".count__counter .counter__items");let i=JSON.parse(localStorage.getItem("cartItems")||"[]");i.length===0&&(l=!0,h(l));const c=i.some(p=>p.id===t.id);if(r){if(!c){C(t,!1,"30",Number(r.innerText)),u(),g();return}!e||!n||!o||(m(`${t.id}`,e.checked,n.textContent||"30",Number(o.textContent)+Number(r.innerText)),D(),u())}}function h(t){if(_&&(t||(d(_,"remove","empty"),v(".cart__empty").forEach(n=>n.remove())),t)){const e=a("p","cart__empty");e.innerText="Your cart is empty",d(_,"add","empty"),_.appendChild(e)}}function u(){let t=JSON.parse(localStorage.getItem("cartItems")||"[]"),e=0,n;const o=s("#total-cart-price");o&&(t?.length===0&&(o.innerText="$0"),t.forEach(async r=>{try{const i=await w(`${r.id}`);if("errors"in i){console.error(i.errors);return}i.type==="Sale%"?n=N(i.price,i.discount,r.counts):n=L(i.price,r.counts),e+=parseFloat(n.replace(/,/g,"").replace(/\s/g,"")),o.innerText=`$${e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`,nt(e)}catch(i){console.error(i)}}))}function nt(t){const e=s(".cart__btn");if(!e)return;const n=s(".btn",e);if(!(!O||!n)&&O.role_type==="whosale"){n.style.backgroundColor="#C3BDB6",n.style.pointerEvents="none";const o=a("p","cart__limit");o.style.marginTop="15px",o.style.textAlign="center",o.style.opacity="0.5",o.style.fontSize="14px",o.style.fontWeight="400",o.innerText="Minimum order amount is $700",s(".cart__limit")||e.appendChild(o),t>=700&&(n.style.backgroundColor="",n.style.pointerEvents="")}}function g(){const t=s(".cart__btn");if(!t)return;const e=s(".btn",t);if(!e)return;if(JSON.parse(localStorage.getItem("cartItems")||"[]").length===0){e.style.backgroundColor="#C3BDB6",e.style.pointerEvents="none";return}e.style.backgroundColor="",e.style.pointerEvents=""}async function ut(t){for(const e of t)try{let n=JSON.parse(localStorage.getItem("cartItems")||"[]");const o=await w(e);if("errors"in o){console.error(o);return}if(!n.some(c=>c.id===o.id)){C(o,!1,"30",1),u(),g();continue}const i=s(`.prod_${o.id} .counter__items`);if(!i)return;m(`${o.id}`,!1,"30",Number(i.textContent)+1),D(),u()}catch(n){console.error(n)}}export{ut as a,lt as b,K as c,ct as d,at as e,st as f,N as g,L as h,j as i,dt as r};
