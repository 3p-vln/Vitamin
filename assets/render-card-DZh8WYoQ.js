import{g as T,h as y}from"./cart-Zl5pb77G.js";import{g as d,r as c,c as v}from"./use-call-dom-DDNnwvp7.js";let f=1,u=10,_=6;const C=window.innerWidth;let g;async function D(t,i){const r=d(t);if(r)try{const e=await T(!1);if("errors"in e){console.error(e.errors);return}const n=e.data;await m(n,r,i)}catch(e){console.error(e)}}function $(){const t=window.innerWidth;t<375?(u=4,_=2):t<768?(u=6,_=6):(u=10,_=10)}async function V(t,i=1,r){$();const e=d(t);if(e)try{let n=await y(i,u,r);if("errors"in n){console.error(n.errors);return}if(n.errors||n.data.length===0){e.innerHTML="<p>Нет товаров в данной категории</p>";return}const o=n.data;await m(o,e,"gray"),C>=768&&L(t,r),C<768&&await E(t,r)}catch(n){console.error(n)}}async function m(t,i,r){t.forEach(e=>{const n=c("a",["prod-card",`${e.id}`,`prod-card_${r}`]);n.href=`one-product.html?id=${e.id}`;const o=c("div","prod-card__content"),a=c("div","prod-card__img");a.innerHTML=`<picture><img src="${e.img}" alt="prod" /></picture>`;const s=c("div","prod-card__discount");s.innerText=`-${e.discount}%`;const l=c("div",["prod-card__info","info"]),h=c("p","info__category");x(e.type,h),h.innerText=e.type;const w=c("p","info__name");w.innerText=e.name;const M=b(e.price,e.discount),p=c("p","info__price");e.type==="Sale%"?(p.innerHTML=`<span>$${e.price}</span> $${M}`,v(p,"add","info__price_sale")):p.innerText=`$${e.price}`,l.appendChild(h),l.appendChild(w),l.appendChild(p),o.appendChild(a),e.type==="Sale%"&&o.appendChild(s),o.appendChild(l),n.appendChild(o),i.appendChild(n)})}function x(t,i){const r={"Vitamins & Dietary Supplements":"info__category_purple",Minerals:"info__category_green-mint","Prenatal Vitamins":"info__category_purple","Pain Relief":"info__category_blue",Antioxidants:"info__category_orange","Weight Loss":"info__category_dark-blue",Probiotics:"info__category_red","Sale%":"info__category_red"};r[t]&&v(i,"add",r[t])}function b(t,i){const r=parseFloat(t);if(isNaN(r))throw new Error("Invalid price format");return(r*(1-i/100)).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}function L(t,i){const r=d(t);if(!r||r.children.length===0)return;const e=new IntersectionObserver(async(o,a)=>{o[0].isIntersecting&&(a.disconnect(),await P(t,i),L(t,i))},{threshold:1}),n=r.lastElementChild;n&&e.observe(n)}async function P(t,i){const r=d(t);if(!r)return;const e=r.scrollTop;i!==g?(f=1,g=i,r.innerHTML=""):f++;try{const n=await y(f,_,i);if("errors"in n){console.error(n.errors);return}if(n.errors||n.data.length===0)return;await m(n.data,r,"gray"),r.scrollTop=e}catch(n){console.error(n)}}async function E(t,i){const r=d(".catalog-list__view-more");if(r){g=i,f=1;try{let e=await y(1,1,i);if("errors"in e){console.error(e.errors);return}const n=e.meta.totalItems,o=d(t);if(!o)return;let a=o.children.length,s=n-a;r.style.display=s>0?"flex":"none",r.replaceWith(r.cloneNode(!0));const l=d(".catalog-list__view-more");l.addEventListener("click",async()=>{s>0&&(await P(t,g),a=o.children.length,s=n-a,l.style.display=s>0?"flex":"none")})}catch(e){console.error(e)}}}export{V as a,D as r};
