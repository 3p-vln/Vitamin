import{g as i,a as x,c as a,r as d}from"./use-call-dom-DDNnwvp7.js";import{A as X}from"./index-CYnvAbVQ.js";import{b as W,a as f}from"./js.cookie-Cj7aMn_Q.js";async function Z(t){let e=null;if(typeof t=="string"?e=i(t):e=t,!e)return;const n=i(".counter__plus",e),o=i(".counter__minus",e),r=i(".counter__items",e);let s=Number(r?.innerText);!r||!n||!o||(N(n,o,s),o.addEventListener("click",()=>{tt(r,s),s=Number(r?.innerText),N(n,o,s)}),n.addEventListener("click",()=>{et(r,s),s=Number(r?.innerText),N(n,o,s)}),D(r,s))}function D(t,e){t.textContent=e.toString()}function tt(t,e){e>1&&(e--,D(t,e))}function et(t,e){e<999&&(e++,D(t,e))}function N(t,e,n){n!==999&&n!==1&&(t.style.opacity="1",e.style.opacity="1"),n===999&&(t.style.opacity="0.3"),n===1&&(e.style.opacity="0.3")}function nt(t){const e=i(".dropdown",t),n=i(".dropdown__box",t),o=i(".dropdown__text",t),r=i(".dropdown__list",t),s=x(".dropdown__item",t);!e||!n||!o||!r||!s||(e.addEventListener("click",c=>j(c,n,r)),s.forEach(c=>{c.addEventListener("click",()=>rt(c,o,n,r))}),document.addEventListener("click",c=>st(c,e,r,n)))}function j(t,e,n){t.stopPropagation(),e&&(e.classList.toggle("dropdown__box_active"),n&&n.classList.toggle("dropdown__list_active"))}function ot(t,e){t&&(a(t,"remove","dropdown__box_active"),e&&a(e,"remove","dropdown__list_active"))}function rt(t,e,n,o){const r=t.textContent;if(r&&e){if(e.tagName.toLowerCase()==="p"&&(e.textContent=r),e.tagName.toLowerCase()==="input"){e.value=r;const s=i("#state-hidden");if(!s)return;s.value=r}j(event,n,o)}}function st(t,e,n,o){e&&n&&!e.contains(t.target)&&!n.contains(t.target)&&ot(o,n)}const z="https://www.mku-journal.online",R="accessToken",w="refreshToken",it="/auth/refresh-token",$=W.create({baseURL:z,headers:{"Content-Type":"application/json"}}),y=W.create({baseURL:z,withCredentials:!0}),T=async t=>{try{return(await t).data}catch(e){return e instanceof X?(console.error("API error:",e.response?.data||e.message),{errors:[{message:e.response?.data?.message||e.message}]}):e instanceof Error?(console.error("General error:",e.message),{errors:[{message:e.message}]}):(console.error("Unknown error:",e),{errors:[{message:"An unexpected error occurred."}]})}},It=(t,e,n)=>T($.get("/catalog/all-list",{params:{type:n,page:t,limit:e}})),Y=t=>T($.get(`/catalog/${t}/info`)),wt=t=>T($.post("/catalog/create-order",t)),$t=t=>T($.get(`${t?"/catalog/recommendations?is_main=true":"/catalog/recommendations"}`)),ct=()=>f.get(R)||null,at=()=>f.get(w)||null,dt=(t,e)=>{f.set(R,t,{path:"/"}),f.set(w,e,{path:"/",expires:1})},lt=()=>{f.remove(R,{path:"/"}),f.remove(w,{path:"/"}),localStorage.removeItem("userInfo"),window.location.href="/Vitamin/login.html"};y.interceptors.request.use(t=>{const e=ct();return e&&t.headers&&(t.headers.authorization=`${e}`),t},t=>Promise.reject(t));let P=!1;const k=[],ut=t=>{k.push(t)},pt=t=>{k.forEach(e=>e(t)),k.splice(0,k.length)};y.interceptors.response.use(t=>t,async t=>{const e=t.config;if(t.response?.status===401&&!e._retry){if(P)return new Promise(n=>{ut(o=>{e.headers&&(e.headers.authorization=`${o}`),n(y(e))})});e._retry=!0,P=!0;try{const n=at();if(!n)throw new Error("No refresh token available");const{data:o}=await y.post(it,{[w]:n});return dt(o.accessToken,o.refreshToken),pt(o.accessToken),e.headers&&(e.headers.authorization=`${o.accessToken}`),y(e)}catch(n){return lt(),Promise.reject(n)}finally{P=!1}}return Promise.reject(t)});const J=i(".header__bag"),h=i(".cart"),M=i(".cart__close"),_t=i(".cart__bg"),p=i(".cart__items"),H=JSON.parse(localStorage.getItem("userInfo")||"[]");let K=x(".prod"),l;const I=i(".info__backbtn");async function Tt(){!J||!M||!_t||!p||(J.addEventListener("click",t=>mt(t)),M.addEventListener("click",()=>ft()),G(),_(),K.forEach(t=>{const e=i(".prod__autoship-text",t);e&&yt(e)}))}function mt(t){t.stopPropagation(),h&&(a(h,"add","cart_active"),I&&(I.style.zIndex="1"),V())}function ft(){h&&(a(h,"remove","cart_active"),I&&(I.style.zIndex="25"),V())}function ht(t){let e=JSON.parse(localStorage.getItem("cartItems")||"[]");e.some(o=>o.id===t)&&e.forEach(async o=>{const r=i(`.prod_${o.id}`);if(!r)return;const s=i(".prod__close",r);s&&s.addEventListener("click",()=>{r.remove(),gt(t)})})}function gt(t){let e=JSON.parse(localStorage.getItem("cartItems")||"[]");if(e=e.filter(n=>n.id!==t),localStorage.setItem("cartItems",JSON.stringify(e)),_(),e.length===0){if(i(".cart__empty"))return;l=!0,g(l),_();return}}function V(){if(!h)return;const t=i("body"),e=i("header");if(!t||!e)return;const n=window.innerWidth-document.documentElement.clientWidth,o=window.scrollY,r=i(".info__backbtn");if(h.classList.contains("cart_active")){t.style.position="fixed",t.style.top=`-${o}px`,t.style.left="0",t.style.width="100%",t.style.overflow="hidden",t.style.paddingRight=`${n}px`,e.style.paddingRight=`${n}px`,o>50&&r&&(r.style.opacity="0");return}const s=Math.abs(parseInt(t.style.top,10))||0;t.style.position="",t.style.top="",t.style.left="",t.style.width="",t.style.overflow="",t.style.paddingRight="",e.style.paddingRight="",r&&(r.style.opacity=""),window.scrollTo(0,s)}function yt(t){window.innerWidth<768&&(t.innerText="Deliver every")}function A(t,e=!1,n="30",o=1){if(!p)return;const r=d("div",["cart__item","prod",`prod_${t.id}`]),s=d("div","prod__img");t.type==="Vitamins & Dietary Supplements"&&a(s,"add","prod__img_purple"),t.type==="Minerals"&&a(s,"add","prod__img_green-mint"),t.type==="Prenatal Vitamins"&&a(s,"add","prod__img_pink"),t.type==="Pain Relief"&&a(s,"add","prod__img_blue"),t.type==="Antioxidants"&&a(s,"add","prod__img_orange"),t.type==="Weight Loss"&&a(s,"add","prod__img_dark-blue"),(t.type==="Probiotics"||t.type==="Sale%")&&a(s,"add","prod__img_red"),s.innerHTML=`
    <img src="${t.img}" alt="" />
  `;const c=d("div","prod__info"),u=d("div","prod__title-and-close"),b=d("p","prod__title");b.innerText=t.name;const v=d("div","prod__close");v.innerHTML=`
    <span></span>
    <span></span>
  `;const E=d("div","prod__counter-and-price"),S=d("div","prod__counter");S.innerHTML=`
    <button class="counter__minus">
      <svg>
        <use href="#minus"></use>
      </svg>
    </button>
    <p class="counter__items">${o}</p>
    <button class="counter__plus">
      <svg>
        <use href="#plus"></use>
      </svg>
    </button>
  `,Z(S);const C=d("p","prod__price"),Q=O(t.price,t.discount,o),F=B(t.price,o);t.type==="Sale%"?(a(C,"add","prod__price_sale"),C.innerHTML=`<span>$${F}</span> $${Q}`):C.innerText=`$${F}`;const L=d("div","prod__autoship");L.innerHTML=`
    <div class="prod__checkbox">
      <input type="checkbox" name="autoship" ${e?"checked":""}/>
      <span></span>
    </div>
    <p class="prod__autoship-text">Autoship every</p>
    <div class="dropdown">
      <div class="dropdown__box">
        <p class="dropdown__text">${n}</p>
        <div class="dropdown__arrow">
          <svg>
            <use href="#back-arrow"></use>
          </svg>
        </div>
      </div>
      <div class="dropdown__list">
        <button class="dropdown__item">10</button>
        <button class="dropdown__item">20</button>
        <button class="dropdown__item">30</button>
        <button class="dropdown__item">40</button>
        <button class="dropdown__item">50</button>
        <button class="dropdown__item">60</button>
      </div>
    </div>
    days
  `,nt(L),u.appendChild(b),u.appendChild(v),E.appendChild(S),E.appendChild(C),c.appendChild(u),c.appendChild(E),c.appendChild(L),r.appendChild(s),r.appendChild(c),p.appendChild(r),l=!1,g(l),xt(t),ht(t.id),q(t)}function O(t,e,n){const o=parseFloat(t);if(isNaN(o))throw new Error("Invalid price format");return(o*(1-e/100)*n).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}function B(t,e){const n=parseFloat(t);if(isNaN(n))throw new Error("Invalid price format");return(n*e).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}function xt(t){let e=JSON.parse(localStorage.getItem("cartItems")||"[]");const n=e.some(u=>u.id===t.id),o=i(".autoship__on-off"),r=i(".count__items");if(!o||!r)return;const s=o.classList.contains("autoship__on-off_active")||!1,c=Number(r.innerText);n||e.push({id:t.id,autoshipChecked:s,autoshipDays:"30",counts:c}),localStorage.setItem("cartItems",JSON.stringify(e))}function q(t){const e=i(`.prod_${t.id} .prod__checkbox input`),n=i(`.prod_${t.id} .dropdown__text`),o=x(`.prod_${t.id} .dropdown__item`),r=i(`.prod_${t.id} .counter__minus`),s=i(`.prod_${t.id} .counter__plus`),c=i(`.prod_${t.id} .counter__items`);!e||!n||!o||!r||!s||!c||(e&&e.addEventListener("change",()=>{m(`${t.id}`,e.checked,n.textContent||"30",Number(c.textContent))}),n&&o.forEach(u=>{u.addEventListener("click",b=>{const v=b.target.textContent||"30";m(`${t.id}`,e.checked,v,Number(c.textContent))})}),r.addEventListener("click",()=>{U(t,Number(c.textContent)),m(`${t.id}`,e.checked,n.textContent||"30",Number(c.textContent)),_()}),s.addEventListener("click",()=>{U(t,Number(c.textContent)),m(`${t.id}`,e.checked,n.textContent||"30",Number(c.textContent)),_()}))}function U(t,e){const n=O(t.price,t.discount,e),o=B(t.price,e),r=i(`.prod_${t.id} .prod__price`);r&&(t.type==="Sale%"?r.innerHTML=`<span>$${o}</span> $${n}`:r.innerText=`$${o}`)}function m(t,e,n,o){let r=JSON.parse(localStorage.getItem("cartItems")||"[]");const s=r.findIndex(c=>c.id===Number(t));s!==-1&&(r[s].autoshipChecked=e,r[s].autoshipDays=n,r[s].counts=o),localStorage.setItem("cartItems",JSON.stringify(r))}function G(){const t=JSON.parse(localStorage.getItem("cartItems")||"[]");if(t.length===0){l=!0,g(l);return}l=!1,g(l),p&&(p.innerHTML="",t.forEach(async e=>{try{const n=await Y(`${e.id}`);if("errors"in n){console.error(n.errors);return}A(n,e.autoshipChecked,e.autoshipDays,e.counts),q(n),K=x(".prod")}catch(n){console.error(n)}}))}function Et(t){let e=JSON.parse(localStorage.getItem("cartItems")||"[]");e.length===0&&(l=!0,g(l)),e.some(o=>o.id===t.id)||A(t),_()}function St(t){if(!t.disabled_subscribe)return;const e=i(`.prod_${t.id} .prod__checkbox input`),n=i(`.prod_${t.id} .dropdown__text`),o=i(".autoship__dropdown .dropdown__text");if(!o)return;const r=o.textContent,s=i(`.prod_${t.id} .counter__items`);!e||!n||!r||!s||(e.checked=!0,n.innerText=r,m(`${t.id}`,e.checked,n.textContent||"30",Number(s.textContent)))}function Lt(t){if(!t.disabled_subscribe)return;const e=i(`.prod_${t.id} .prod__checkbox input`),n=i(`.prod_${t.id} .dropdown__text`),o=i(`.prod_${t.id} .counter__items`);!e||!n||!o||(e.checked=!1,m(`${t.id}`,e.checked,n.textContent||"30",Number(o.textContent)))}function Nt(t){const e=i(`.prod_${t.id} .prod__checkbox input`),n=i(`.prod_${t.id} .dropdown__text`),o=i(`.prod_${t.id} .counter__items`),r=i(".count__counter .counter__items");let s=JSON.parse(localStorage.getItem("cartItems")||"[]");s.length===0&&(l=!0,g(l));const c=s.some(u=>u.id===t.id);if(r){if(!c){A(t,!1,"30",Number(r.innerText)),_();return}!e||!n||!o||(m(`${t.id}`,e.checked,n.textContent||"30",Number(o.textContent)+Number(r.innerText)),G(),_())}}function g(t){if(p&&(t||(a(p,"remove","empty"),x(".cart__empty").forEach(n=>n.remove())),t)){const e=d("p","cart__empty");e.innerText="Your cart is empty",a(p,"add","empty"),p.appendChild(e)}}function _(){let t=JSON.parse(localStorage.getItem("cartItems")||"[]"),e=0,n;const o=i("#total-cart-price");o&&(t?.length===0&&(o.innerText="$0"),t.forEach(async r=>{try{const s=await Y(`${r.id}`);if("errors"in s){console.error(s.errors);return}s.type==="Sale%"?n=O(s.price,s.discount,r.counts):n=B(s.price,r.counts),e+=parseFloat(n.replace(/,/g,"").replace(/\s/g,"")),o.innerText=`$${e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`,bt(e)}catch(s){console.error(s)}}))}function bt(t){const e=i(".cart__btn");if(!e)return;const n=i(".btn",e);if(!(!H||!n)&&H.role_type==="whosale"){n.style.backgroundColor="#C3BDB6",n.style.pointerEvents="none";const o=d("p","cart__limit");o.style.marginTop="15px",o.style.textAlign="center",o.style.opacity="0.5",o.style.fontSize="14px",o.style.fontWeight="400",o.innerText="Minimum order amount is $700",i(".cart__limit")||e.appendChild(o),t>=700&&(n.style.backgroundColor="",n.style.pointerEvents="")}}export{Y as a,Nt as b,mt as c,Et as d,St as e,Z as f,$t as g,It as h,nt as i,Tt as j,O as k,B as l,wt as m,Lt as r};
