import{g as T,b as m}from"./useApi-DF1n4dod.js";import{g as l,r as c,c as v}from"./useCallDom-DDNnwvp7.js";let f=1,u=10,_=6;const C=window.innerWidth;let g;async function R(e){const i=l(e);if(!i)return;const n=await T(!1);if(n.errors)return;const t=n.data;await y(t,i,"white")}function $(){const e=window.innerWidth;e<375?(u=4,_=2):e<768?(u=6,_=6):(u=10,_=10)}async function V(e,i=1,n){$();const t=l(e);if(!t)return;let r=await m(i,u,n);if(r.errors||r.data.length===0){t.innerHTML="<p>Нет товаров в данной категории</p>";return}const a=r.data;await y(a,t,"gray"),C>=768&&L(e,n),C<768&&E(e,n)}async function y(e,i,n){e.forEach(t=>{const r=c("a",["prod-card",`${t.id}`,`prod-card_${n}`]);r.href=`one-product.html?id=${t.id}`;const a=c("div","prod-card__content"),o=c("div","prod-card__img");o.innerHTML=`<picture><img src="${t.img}" /></picture>`;const s=c("div","prod-card__discount");s.innerText=`-${t.discount}%`;const d=c("div",["prod-card__info","info"]),h=c("p","info__category");b(t.type,h),h.innerText=t.type;const w=c("p","info__name");w.innerText=t.name;const M=x(t.price,t.discount),p=c("p","info__price");t.type==="Sale%"?(p.innerHTML=`<span>$${t.price}</span> $${M}`,v(p,"add","info__price_sale")):p.innerText=`$${t.price}`,d.appendChild(h),d.appendChild(w),d.appendChild(p),a.appendChild(o),t.type==="Sale%"&&a.appendChild(s),a.appendChild(d),r.appendChild(a),i.appendChild(r)})}function b(e,i){const n={"Vitamins & Dietary Supplements":"info__category_purple",Minerals:"info__category_green-mint","Prenatal Vitamins":"info__category_purple","Pain Relief":"info__category_blue",Antioxidants:"info__category_orange","Weight Loss":"info__category_dark-blue",Probiotics:"info__category_red","Sale%":"info__category_red"};n[e]&&v(i,"add",n[e])}function x(e,i){const n=parseFloat(e);if(isNaN(n))throw new Error("Invalid price format");return(n*(1-i/100)).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}function L(e,i){const n=l(e);if(!n||n.children.length===0)return;const t=new IntersectionObserver(async(a,o)=>{a[0].isIntersecting&&(o.disconnect(),await P(e,i),L(e,i))},{threshold:1}),r=n.lastElementChild;r&&t.observe(r)}async function P(e,i){const n=l(e);if(!n)return;const t=n.scrollTop;i!==g?(f=1,g=i,n.innerHTML=""):f++;const r=await m(f,_,i);r.errors||r.data.length===0||(await y(r.data,n,"gray"),n.scrollTop=t)}async function E(e,i){const n=l(".catalog-list__view-more");if(!n)return;g=i,f=1;let t=await m(1,1,i);if(!S(t)||t.errors)return;const r=t.meta.totalItems,a=l(e);if(!a)return;let o=a.children.length,s=r-o;n.style.display=s>0?"flex":"none",n.replaceWith(n.cloneNode(!0));const d=l(".catalog-list__view-more");d.addEventListener("click",async()=>{s>0&&(await P(e,g),o=a.children.length,s=r-o,d.style.display=s>0?"flex":"none")})}function S(e){return typeof e=="object"&&e!==null&&"data"in e&&Array.isArray(e.data)}export{V as a,x as g,R as r};
